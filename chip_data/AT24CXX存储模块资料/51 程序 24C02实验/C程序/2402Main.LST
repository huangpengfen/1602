C51 COMPILER V9.00   2402MAIN                                                              04/02/2012 16:58:28 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE 2402MAIN
OBJECT MODULE PLACED IN 2402Main.OBJ
COMPILER INVOKED BY: E:\°²×°Èí¼þ\keil-51\C51\BIN\C51.EXE 2402Main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1                                                             
   2          /********************************************************************************                                                                                                                                                                
             -  
   3          * ¡¾±àÐ´Ê±¼ä¡¿£º 2011.07.07
   4          * ¡¾×÷    Õß¡¿£º Ñãôáµç×Ó
   5          * ¡¾°æ    ±¾¡¿£º V1.0
   6          * ¡¾Íø    Õ¾¡¿£º http://ylelectronic.taobao.com/ 
   7          * ¡¾Q      Q¡¿£º 348439350
   8          * ¡¾Éù    Ã÷¡¿£º ´Ë³ÌÐò½öÓÃÓÚÑ§Ï°Óë²Î¿¼£¬ÒýÓÃÇë×¢Ã÷°æÈ¨ºÍ×÷ÕßÐÅÏ¢£¡
   9          * ¡¾º¯Êý¹¦ÄÜ¡¿£º AT24C02ÊµÑé
  10          * ¡¾¾§    Õñ¡¿:  11.0592M                   
  11          * ¡¾Ó²¼þÁ¬½Ó¡¿£º ÌøÏß   Ñ¡ÔñÄ£¿é                        Á¬½Ó»ò¶Ï¿ª
  12                           J1             8Î»ÊýÂë¹ÜÄ£¿é           Á¬½Ó
  13                                           J2             µãÕóÄ£¿é                        ¶Ï¿ª
  14                                           J3             Ê±ÖÓÄ£¿é                        ¶Ï¿ª
  15                                           J4             8Î»ÅÜÂíµÆÄ£¿é           ¶Ï¿ª
  16                                           J6             ·äÃùÆ÷Ä£¿é                      ¶Ï¿ª
  17                                           J7             ¼ÌµçÆ÷Ä£¿é                      ¶Ï¿ª                                                                        
  18          * ¡¾Ê¹ÓÃËµÃ÷¡¿£º        °´ÏÂ¶ÀÁ¢°´¼üK1 ±£´æÊý¾Ý     
  19                              °´ÏÂ¶ÀÁ¢°´¼üK2 ¶ÁÈ¡Êý¾Ý                                                                
  20                              °´ÏÂ¶ÀÁ¢°´¼üK3 Êý¾Ý¼õ1    
  21                              °´ÏÂ¶ÀÁ¢°´¼üK4 Êý¾Ý¼Ó1  
  22          *******************************************************************************/
  23          /*Ô¤´¦ÀíÃüÁî*/
  24          #include<reg52.h>    //°üº¬µ¥Æ¬»ú¼Ä´æÆ÷µÄÍ·ÎÄ¼þ  
  25          #include<Function.h>
  26          #define uchar unsigned char
  27          #define uint unsigned int
  28          
  29          #define  AT24C02 0xa0  //AT24C02 µØÖ·
  30          
  31          sbit MOSIO=P2^2;           //ÒÆÎ»¼Ä´æÆ÷-Çý¶¯ÊýÂë¹Ü
  32          sbit R_CLKa=P2^3;
  33          sbit S_CLKa=P2^4; 
  34          
  35          sbit K1=P3^2;    //±£´æ
  36          sbit K2=P3^3;    //¶ÁÈ¡
  37          sbit K3=P3^4;    //+Êý¾Ý
  38          sbit K4=P3^5;   //-Êý¾Ý
  39          
  40          uchar code duan[]={~0x3F,~0x06,~0x5B,~0x4F,~0x66,~0x6D,~0x7D,~0x07,~0x7F,~0x6F};//´Ë±íÎªLED¹²Ñô¼¶ÊýÂë¹Ü¶ÎÑ
             -¡×ÖÄ£ 
  41          uchar code wei[]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};     //´Ë±íÎªLEDÊýÂë¹ÜÎ»Ñ¡×ÖÄ£
  42          
  43          uchar Count1;
  44          unsigned long D[16], LedOut[5],LedNumVal;
  45          uint idata USEC;
  46          
  47          void delay(uint i)
  48          {
  49   1          char j;
  50   1          for(i; i > 0; i--)
  51   1              for(j = 200; j > 0; j--);
  52   1      }  
  53          /***************74HC595Çý¶¯ÊýÂë¹Ü³ÌÐò******************/
C51 COMPILER V9.00   2402MAIN                                                              04/02/2012 16:58:28 PAGE 2   

  54          void send595(uchar dat)    //Êý¾ÝÊäÈë
  55          {  
  56   1              uchar i;        
  57   1              for(i=0;i<8;i++) 
  58   1              {
  59   2                      if((dat<<i)&0x80) 
  60   2                              MOSIO=1; 
  61   2                      else MOSIO=0;
  62   2                      
  63   2                      S_CLKa=0;
  64   2                      S_CLKa=1;       
  65   2              }       
  66   1      
  67   1      }
  68          void out595(void)                         // Êý¾ÝÊä³ö
  69          {
  70   1              R_CLKa=0;
  71   1              R_CLKa=1;       //ÉÏÉýÑØ
  72   1      } 
  73          void disp(uchar w,uchar d)        //ÊýÂë¹ÜÏÔÊ¾º¯Êý£ºw-Î»Âë£¬d-¶ÎÂë
  74          {
  75   1              send595(wei[w]);
  76   1              send595(duan[d]);
  77   1              out595();
  78   1      }
  79          void dispoff()      //¹Ø±Õ¹²ÑôÊýÂë¹Ü
  80          {
  81   1              send595(0);
  82   1              out595();
  83   1              
  84   1              send595(0xff);
  85   1              out595();
  86   1      }
  87          /**********************ÏµÍ³³õÊ¼»¯*************************/
  88          void  system_ini() 
  89          {    
  90   1          TMOD|= 0x11;
  91   1          TH1=0xfe; //11.0592
  92   1              TL1=0x33;
  93   1              TR1=1; 
  94   1          IE=0x8A;
  95   1      }
  96          /**********************Ö÷º¯Êý**************************/
  97          void main()
  98          {
  99   1              uchar i;
 100   1              uchar pDat[8];
 101   1              dispoff();                      //ÏÈ¹Ø±ÕÊýÂë¹Ü
 102   1              system_ini();
 103   1              while(1)
 104   1              {
 105   2                      //========================IIC ¶ÁÈ¡
 106   2                      if(K2 == 0)        //µÚ¶þ¸ö°´Å¥¶ÁÈ¡Êý¾Ý
 107   2                      { 
 108   3                              IRcvStr(AT24C02, 0 , &pDat[0], 8); 
 109   3                              for (i=0; i<4; i++)
 110   3                              {
 111   4                                      D[14+i]=pDat[i*2+0]+pDat[i*2+1]*0x100;
 112   4                                      Count1 = D[14];
 113   4                              }            
 114   3                      }
 115   2                      
C51 COMPILER V9.00   2402MAIN                                                              04/02/2012 16:58:28 PAGE 3   

 116   2                      //========================IIC ±£´æ
 117   2                      if(K1 == 0)    //µÚÒ»¸ö°´Å¥±£´æÊý¾Ý
 118   2                      { 
 119   3                              D[14]= Count1;
 120   3                              for (i=0; i<4; i++)
 121   3                              {
 122   4                                      pDat[i*2+0]=D[14+i];
 123   4                                      pDat[i*2+1]=D[14+i]>>8;
 124   4                              }
 125   3                              ISendStr(AT24C02, 0 , &pDat[0], 8); 
 126   3                      }
 127   2                      
 128   2                      
 129   2                      /********ÒÔÏÂ½«2402ÖÐ±£´æµÄÊý¾ÝËÍµ½LEDÊýÂë¹ÜÏÔÊ¾*************/
 130   2                      LedNumVal=Count1;
 131   2                      LedOut[0]=LedNumVal%10000/1000;
 132   2                      LedOut[1]=LedNumVal%1000/100;
 133   2                      LedOut[2]=LedNumVal%100/10;
 134   2                      LedOut[3]=LedNumVal%10; 
 135   2                      
 136   2                      for(i=0; i<4; i++) 
 137   2                      {               
 138   3                              disp(i,LedOut[i]);
 139   3                              delay(150);
 140   3                      }       
 141   2              }
 142   1      } 
 143          
 144          /*************************************
 145           [ t1 (0.5ms)ÖÐ¶Ï] ÖÐ¶ÏÖÐ×ö PWM Êä³ö
 146            ------------1000/(0.02ms*250)=200Hz
 147          *************************************/
 148          void T1zd(void) interrupt 3   //3 Îª¶¨Ê±Æ÷1µÄÖÐ¶ÏºÅ  1 ¶¨Ê±Æ÷0µÄÖÐ¶ÏºÅ 0 Íâ²¿ÖÐ¶Ï1 2 Íâ²¿ÖÐ¶Ï2  4 ´®¿ÚÖÐ¶Ï
 149          {
 150   1               TH1 = 0xfe; //12M      
 151   1               TL1 = 0x33;
 152   1         if(USEC++==200)
 153   1         {    USEC=0;
 154   2               
 155   2          if (K3) Count1++;     //¸Ä±äÊý¾Ý
 156   2          if (K4&Count1!=0) Count1--;
 157   2        
 158   2          }  
 159   1      
 160   1      }
 161          
 162          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    571    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     89       9
   IDATA SIZE       =      2    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
